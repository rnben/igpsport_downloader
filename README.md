# iGPSport 骑行数据下载器

这是一个用于批量下载iGPSport平台骑行数据FIT文件的Python脚本。

## 功能特性

- 🔄 **自动分页获取**：自动获取所有页面的活动列表
- 📁 **智能命名**：根据时间和活动标题自动生成文件名
- ⏸️ **断点续传**：已下载的文件会自动跳过
- 🎯 **灵活过滤**：支持按标题过滤和数量限制
- 📊 **实时进度**：显示下载进度和状态信息
- 🛡️ **错误处理**：完善的错误处理和重试机制

## 安装依赖

```bash
pip install requests
```

## 使用方法

### 1. 获取浏览器请求头

在运行脚本之前，你需要从浏览器中获取鉴权请求头：

1. 打开iGPSport网站并登录
2. 按F12打开开发者工具
3. 切换到"网络"(Network)标签页
4. 在网站中操作（比如查看活动列表）
5. 找到API请求（通常是`queryMyActivity`相关的请求）
6. 点击该请求，复制完整的"请求头"(Request Headers)

### 2. 配置脚本

打开 `igpsport_downloader.py` 文件，找到用户配置区域：

```python
# ========================================
# 用户配置区域 - 请在这里填写你的请求头
# ========================================

user_headers = {
    # 在这里粘贴你的浏览器请求头
    # 示例:
    'Cookie': 'your_cookie_here',
    'Authorization': 'Bearer your_token_here',
    'User-Agent': 'your_user_agent_here',
}
```

将你复制的请求头信息填入 `user_headers` 字典中。

### 3. 下载配置（可选）

你还可以配置以下选项：

```python
# 限制下载数量，None表示下载全部
download_limit = 10  # 例如：只下载前10个活动

# 活动标题过滤，None表示不过滤
title_filter = '骑行'  # 例如：只下载标题包含'骑行'的活动
```

### 4. 运行脚本

```bash
python igpsport_downloader.py
```

## 输出说明

脚本会在当前目录下创建一个 `downloads` 文件夹，所有下载的FIT文件都会保存在这里。

文件命名格式：`时间_标题_rideId_原文件名.fit`

例如：`2025-06-05_户外骑行_32062249_filename.fit`

## 工作流程

脚本会按照以下步骤执行：

1. **获取活动列表**：分页获取所有活动信息
2. **过滤活动**：根据你的设置过滤活动
3. **获取下载链接**：为每个活动获取FIT文件下载链接
4. **下载文件**：逐个下载FIT文件到本地
5. **进度显示**：实时显示下载进度和状态

## 常见问题

### Q: 脚本提示"还没有配置请求头"
A: 这是因为你还没有填写 `user_headers` 字典。请按照上面的步骤获取浏览器请求头并填入脚本中。

### Q: 下载过程中出现认证错误
A: 可能是Cookie过期了。请重新登录iGPSport网站，获取最新的请求头。

### Q: 某些文件下载失败
A: 脚本会自动跳过失败的文件并继续下载其他文件。你可以重新运行脚本，已下载的文件会被跳过。

### Q: 如何只下载特定类型的活动？
A: 设置 `title_filter` 参数，例如 `title_filter = '青山湖'` 只下载标题包含"青山湖"的活动。

### Q: 如何限制下载数量？
A: 设置 `download_limit` 参数，例如 `download_limit = 5` 只下载前5个活动。

## 注意事项

- 请确保你的网络连接稳定
- 大量文件下载可能需要较长时间
- 请遵守iGPSport的使用条款
- 建议定期备份下载的数据文件

## 技术实现

脚本基于以下API端点：

1. `GET /service/web-gateway/web-analyze/activity/queryMyActivity` - 获取活动列表
2. `GET /service/web-gateway/web-analyze/activity/getDownloadUrl/{rideId}` - 获取下载链接
3. `GET {download_url}` - 下载FIT文件

所有请求都会使用你提供的请求头进行身份验证。

## 许可证

本脚本仅供学习和个人使用，请勿用于商业用途。
